from androguard.misc import AnalyzeAPK
import os
import Mal_API_RULE

os.chdir("E:\프로젝트\malware")
a, d, dx = AnalyzeAPK("woori.apk")

api_list=[]
api_dic={}
for method in dx.find_methods():
    if method.is_external():
        continue
    m = method.get_method()
    for inst in m.get_instructions():
        try:
            if(inst.get_name().startswith('invoke')):
                out_put=inst.get_output()
                left_index=out_put.index('L')
                right_index=out_put.index('(')
                api=out_put[left_index+1:right_index]
                api=api.replace('/','.').replace(';->','.')
                #print(api)
                if(api.startswith('java') or api.startswith('android')):
                    if not "support" in api and "arch":
                        for i in Mal_API_RULE.MAL_API:
                            if(api.startswith(i)):
                                api_list.append(api)
                        
        except:
            break
    
for api_lst in api_list:
    try: api_dic[api_lst] += 1
    except: api_dic[api_lst] = 1
#print(api_dic)

for function in api_dic.keys():
    print(function,":",api_dic[function],"개")
